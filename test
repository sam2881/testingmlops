select_exprs = []
for field in df.schema.fields:
    field_name = field.name
    if isinstance(field.dataType, ArrayType):
        array_col = col(field_name)
        if isinstance(field.dataType.elementType, StructType):
            struct_fields = [col(f"{field_name}.{nested_field.name}").alias(nested_field.name) for nested_field in field.dataType.elementType.fields]
            select_exprs.extend(struct_fields)
        else:
            select_exprs.append(array_col)
    elif isinstance(field.dataType, StructType):
        struct_fields = [col(f"{field_name}.{nested_field.name}").alias(nested_field.name) for nested_field in field.dataType.fields]
        select_exprs.extend(struct_fields)
    else:
        select_exprs.append(col(field_name))
